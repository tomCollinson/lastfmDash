"use strict";angular.module("lastfmDashApp",["ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"})}]),angular.module("lastfmDashApp").controller("MainCtrl",["$scope","$timeout","AjaxCall",function(){}]),angular.module("lastfmDashApp").controller("HeaderCtrl",["$scope","$location","$route","$rootScope","$element",function(a,b,c,d){a.isActive=function(c){return c.path===b.path().substring(9)?(a.pageTitle=c.title,d.currentSection=c.path,!0):!1}}]),angular.module("lastfmDashApp").factory("AjaxCall",["$http",function(a){return{get:function(b,c){return a.get(b,{params:c})}}}]),angular.module("lastfmDashApp").directive("trackGrid",function(){return{templateUrl:"views/trackgrid.html",restrict:"A",controller:["$scope","$element","$attrs","AjaxCall","$timeout",function(a,b,c,d,e){a.getData=function(){d.get("query.php",{method:"user.getrecenttracks",user:"crimsonc",limit:24,extended:1,format:"json"}).then(function(b){a.data=b.data.recenttracks;for(var c=0;c<a.data.track.length;c+=1){var d=a.data.track[c].artist.name,f=a.data.track[c].name,g=d+" - "+f;a.data.track[c].spotify=g}console.log(a.data),e(function(){lastfmDash.resizeTrack(),lastfmDash.lazyloading()},100)})},a.intervalFunction=function(){e(function(){a.getData(),a.intervalFunction()},12e4)},a.getData(),a.intervalFunction()}],link:function(){}}}),angular.module("lastfmDashApp").directive("track",function(){return{restrict:"A",controller:["$scope","AjaxCall",function(a,b){a.getSpotifyData=function(c){var d,e;b.get("http://ws.spotify.com/search/1/track.json",{q:c}).then(function(b){d="none",void 0!==b.data.tracks[0]?(d=b.data.tracks[0].href,e=d.lastIndexOf(":"),d="http://open.spotify.com/track/"+d.substring(e+1)):d="none",a.spotifyUrl=d})}}],link:function(){}}}),function(a){a.fn.unveil=function(b,c){function d(){var b=j.filter(function(){var b=a(this);if(!b.is(":hidden")){var c=f.scrollTop(),d=c+f.height(),e=b.offset().top,h=e+b.height();return h>=c-g&&d+g>=e}});e=b.trigger("unveil"),j=j.not(e)}var e,f=a(window),g=b||0,h=window.devicePixelRatio>1,i=h?"ng-data-src-retina":"ng-data-src",j=this;return this.one("unveil",function(){var a=this.getAttribute(i);a=a||this.getAttribute("ng-data-src"),a&&(this.setAttribute("src",a),"function"==typeof c&&c.call(this))}),f.on("scroll.unveil resize.unveil lookup.unveil",d),d(),this}}(window.jQuery||window.Zepto);var lastfmDash=function(a){function b(){var b=1,c=a(window).innerWidth(),d=a(".track");c>=380&&720>c?b=2:c>=720&&1024>c?b=3:c>=1024&&1300>c?b=4:c>=1300&&(b=5),d.css({height:c/b,width:c/b})}function c(){a("img").unveil()}return{init:function(){b(),c()},resizeTrack:b,lazyloading:c}}(jQuery);$(document).ready(function(){lastfmDash.init()}),$(window).on("resize",function(){lastfmDash.resizeTrack()});